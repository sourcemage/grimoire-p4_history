#!/bin/bash
#
# SMGL init script for the codafs server
#

PROGRAM=/bin/false
RUNLEVEL=3
NEEDS="+remote_fs +network"
SCMFILE=/vice/db/scm

. /etc/init.d/smgl_init

VICE=/vice
VICESRV=${VICE}/srv
PIDDIR=${VICE}/srv

start()
{
    required_executable /usr/sbin/volutil
    required_executable /usr/sbin/codasrv
    required_executable /usr/sbin/startserver
    
    if [ ! -f ${VICESRV}/CRASH ]; then
	echo   "Starting Coda server"
	loadproc /usr/sbin/volutil
	loadproc /usr/sbin/codasrv
	loadproc /usr/sbin/startserver
    else
	echo "`date`: found CRASH, srv not started." >> ${VICE}/srv/SrvErr
	echo "found CRASH file, srv not started."
    fi

}

stop()
{
    volutil shutdown
    echon "sleeping 30 secs to let srv shutdown..."
    sleep 30
    
    OU BIEN

    echo   "Stopping Coda server"
    killproc /usr/sbin/codasrv
}
