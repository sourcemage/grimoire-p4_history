# @usage configure_optional <1:test> <2:enable-option> <3:disable-option> <4:prompt> <5:hint>
# works right if <test> is part of both <enable-option> and <disable-option>
# @return 0 if disabled
function configure_optional() {
  if ! grep -q "${1#-}" $SPELL_CONFIG; then
    local OPTION="$2"
    query "$4" "$5" || OPTION="$3"
    echo "OPTS=\"\$OPTS $OPTION\"" >> $SPELL_CONFIG
  fi
  # return the `enabled' flag for the option
  grep -q "${2#--}" $SPELL_CONFIG
}

if  !  grep  -q  "RUN_GRUB"  $SPELL_CONFIG;  then
 
  if    query  "Run GRUB automatically upon GRUB upgrades?" n
  then  echo   "RUN_GRUB=y"  >>  $SPELL_CONFIG
  else  echo   "RUN_GRUB=n"  >>  $SPELL_CONFIG
  fi
 
fi
 
if  !  grep  -q  "GRUB_TARGET"  $SPELL_CONFIG;  then
 
  message  "Please tell me where you would like grub installed."
  message  "Choices include the MBR of the first drive (hd0),"
  message  "the MBR of the second (or later) drive (hd1), (hd2) etc."
  message  "or a partition on one of the drives, e.g. (hd0,0)."
  if    query  "Would You like GRUB installed onto the MBR of the first drive?" y
  then
    GRUB_TARGET=\(hd0\)
  else
    message  "IMPORTANT: use the following format: drive,partition (no spaces)"
    message  "to specify a partition, or 'drive' to specify the MBR of a drive."    message  "All numbers are 0 based, so the first drive is drive '(hd0)', and"    message  "the first partition is partition '(hd0,0)'. I.e. if you want GRUB"    message  "installed on /dev/hda1 (or /dev/sda1 if you have a SCSI system)"
    message  "then you would specify '(hd0,0)' as the target drive,partition."
    message  "which drive or drive,partition do you want grub installed on."
    message  "Be sure to include the parenthesis, with NO spaces within the parenthesis."
    message  "[e.g. (hd0,0), (hd0,1), (hd1), (hd1,0), etc.]?"
    echo -n  "GRUB_TARGET=(hd#,#):  "
    read GRUB_TARGET
  fi
  # the leading space appears to be critical, hence the escaped quotes:
  echo  "GRUB_TARGET=\" $GRUB_TARGET\"" >> $SPELL_CONFIG
  message  "GRUB is configured to install on $GRUB_TARGET."
fi

configure_optional	'ext2fs'		'--enable-ext2fs'			'--disable-ext2fs'			'Enable ext2fs support in Stage 2?' y
configure_optional	'fat'			'--enable-fat'				'--disable-fat'				'Enable FAT support in Stage 2?' y
configure_optional	'ffs'			'--enable-ffs'				'--disable-ffs'				'Enable FFS support in Stage 2?' y
configure_optional	'minix'			'--enable-minix'			'--disable-minix'			'Enable Minix support in Stage 2?' y
configure_optional	'reiserfs'		'--enable-reiserfs'			'--disable-reiserfs'			'Enable ReiserFS support in Stage 2?' y
configure_optional	'vstafs'		'--enable-vstafs'			'--disable-vstafs'			'Enable VSTAa FS support in Stage 2?' y
configure_optional	'jfs'			'--enable-jfs'				'--disable-jfs'				'Enable IBM JFS support in Stage 2?' y
configure_optional	'xfs'			'--enable-xfs'				'--disable-xfs'				'Enable SGI XFS support in Stage 2?' y
configure_optional	'gunzip'		'--enable-gunzip'			'--disable-gunzip'			'Enable decompression in Stage 2?' y
configure_optional	'md5-password'		'--enable-md5-password'			'--disable-md5-password'			'Enable MD5 password support in Stage 2?' y
configure_optional	'packet-retransmission'	'--enable-packet-retransmission'	'--disable-packet-retransmission'	'Enable packet retransission?' y
configure_optional	'pci-direct'		'--enable-pci-direct'			'--disable-pci-direct'			'Access PCI directrly instead of using BIOS?' n
configure_optional	'3c509'			'--enable-3c509'			'--disable-3c509'			'Enable 3Com509 driver?' n
configure_optional	'3c529'			'--enable-3c529'			'--disable-3c529'			'Enable 3Com529 driver?' n
configure_optional	'3c595'			'--enable-3c595'			'--disable-3c595'			'Enable 3Com595 driver?' n
configure_optional	'3c90x'			'--enable-3c90x'			'--disable-3c90x'			'Enable 3Com90x driver?' n
configure_optional	'cs89x0'		'--enable-cs89x0'			'--disable-cs89x0'			'Enable CS89x0 driver?' n
configure_optional	'davicom'		'--enable-davicom'			'--disable-davicom'			'Enable Davicom driver?' n
configure_optional	'depca'			'--enable-depca'			'--disable-depca'			'Enable DEPCA driver?' n
configure_optional	'eepro'			'--enable-eepro'			'--disable-eepro'			'Enable Etherexpress Pro/10 driver?' n
configure_optional	'eepro100'		'--enable-eepro100'			'--disable-eepro100'			'Enable Etherexpress Pro/100 driver?' n
configure_optional	'epic100'		'--enable-epic100'			'--disable-epic100'			'Enable SMC 83c170 EPIC/100 driver?' n
configure_optional	'3c507'			'--enable-3c507'			'--disable-3c507'			'Enable 3Com507 driver?' n
configure_optional	'exos205'		'--enable-exos205'			'--disable-exos205'			'Enable EXOS205 driver?' n
configure_optional	'ni5210'		'--enable-ni5210'			'--disable-ni5210'			'Enable Racal-Interlan NI5210 driver?' n
configure_optional	'lance'			'--enable-lance'			'--disable-lance'			'Enable Lance PCI PCNet/32 driver?' n
configure_optional	'ne2100'		'--enable-ne2100'			'--disable-ne2100'			'Enable Novell NE2100 driver?' n
configure_optional	'ni6510'		'--enable-ni6510'			'--disable-ni6510'			'Enable Racal-Interlan NI6510 driver?' n
configure_optional	'natsemi'		'--enable-natsemi'			'--disable-natsemi'			'Enable NatSemi DP8381x driver?' n
configure_optional	'ni5010'		'--enable-ni5010'			'--disable-ni5010'			'Enable Racal-Interlan NI5010 driver?' n
configure_optional	'3c503'			'--enable-3c503'			'--disable-3c503'			'Enable 3Com503 driver?' n
configure_optional	'ne'			'--enable-ne'				'--disable-ne'				'Enable NE1000/2000 ISA driver?' n
configure_optional	'ns8390'		'--enable-ns8390'			'--disable-ns8390'			'Enable NE2000 PCI driver?' n
configure_optional	'wd'			'--enable-wd'				'--disable-wd'				'Enable WD8003/8013, SMC8216/8416 driver?' n
configure_optional	'otulip'		'--enable-otulip'			'--disable-otulip'			'Enable old Tulip driver?' n
configure_optional	'rtl8139'		'--enable-rtl8139'			'--disable-rtl8139'			'Enable Realtek 8139 driver?' n
configure_optional	'sis900'		'--enable-sis900'			'--disable-sis900'			'Enable SIS 900 and SIS 7016 driver?' n
configure_optional	'sk-g16'		'--enable-sk-g16'			'--disable-sk-g16'			'Enable Schneider and Koch G16 driver?' n
configure_optional	'smc9000'		'--enable-smc9000'			'--disable-smc9000'			'Enable SMC9000 driver?' n
configure_optional	'tiara'			'--enable-tiara'			'--disable-tiara'			'Enable Tiara driver?' n
configure_optional	'tulip'			'--enable-tulip'			'--disable-tulip'			'Enable Tulip driver?' n
configure_optional	'via-rhine'		'--enable-via-rhine'			'--disable-via-rhine'			'Enable Rhine-I/II driver driver?' n
configure_optional	'w89c840'		'--enable-w89c840'			'--disable-w89c840'			'Enable Winbond W89c840, Compex RL100-ATX driver?' n
configure_optional	'3c503-shmem'		'--enable-3c503-shmem'			'--disable-3c503-shmem'			'Use 3c503 shared memory mode?' n
configure_optional	'3c503-aui'		'--enable-3c503-aui'			'--disable-3c503-aui'			'Use AUI by default on 3c503 cards?' n
configure_optional	'compex-rl2000-fix'	'--enable-compex-rl2000-fix'		'--disable-compex-rl2000-fix'		'Specify this if you have a Compex RL2000 PCI?' n
configure_optional	'diskless'		'--enable-diskless'			'--disable-diskless'			'Enable diskless?' n
configure_optional	'hercules'		'--enable-hercules'			'--disable-hercules'			'Enable hercules terminal support?' y
configure_optional	'serial'		'--enable-serial'			'--disable-serial'			'Enable serial terminal support?' y
configure_optional	'auto-linux-mem-opt'	'--enable-auto-linux-mem-opt'		'--disable-auto-linux-mem-opt'		'Pass Linux mem= option automatically?' n