# CONFIGURE for net-tools

pushd $SCRIPT_DIRECTORY > /dev/null
DO_CONFIG=yes
if  [  -f  $CONFIG_CACHE/net-tools.config.h  ]  ;  then
  query  "Reconfigure net-tools?"  n  ||  DO_CONFIG=no
fi

if  [  "$DO_CONFIG" = "yes"  ]  ;  then
  ./configure.sh  config.in
  cp  config.h  $CONFIG_CACHE/net-tools.config.h
  rm  -f  config.h  config.make  config.log  config.status
fi
popd > /dev/null

# lib_netsetup has a group of variables and functions we will use.

. $SCRIPT_DIRECTORY/lib_netsetup

# This changes the files in the /etc/sysconfig/network to apply use
# the new naming scheme if necessary, creates /etc/sysconfig/network
# and adds the lo.dev file if they don't exist.

switch2net_tools
make_lo

# check if it's an initial install, update or whatever
dialog --backtitle "$sgl_logo"  --yesno\
	"The net-tools spell installs a basic networking.sh script that uses the SGL init.d script functions, provided by the init.d spell which is now required by the net-tools spell, and then adds a number of cards that your network uses. 

Select Yes if you want to install net-tools for the first time, select No or hit Esc to update your existing net-tools installation." 0 0
# if answer is yes, skip to the installation.
if [ ! $? = 0 ]; then
    ans=y
    while [ $ans = y ]; do
	dialog --backtitle "$sgl_logo" --nocancel --menu\
	    "You are updating the net-tools spell from an existing installation. You may also use this spell to configure your networking setup. Choose Update if you want to update an earlier version with the latest available networking.sh script and you have already created your network device files. Choose Modify to add or change a network device file before updating. Choose Upgrade to upgrade to use the functions and add the necessary network device files.

Which do you want to do?" 0 0 0\
	    "Update" "Update only without making other changes."\
	    "Modify" "Add a new NIC card or change an existing one before updating."\
	    "Upgrade" "Upgrade an existing network to work with the SGL script functions."\
	    2>$SCRIPT_DIRECTORY/network.temp
	network_test=$(cat $SCRIPT_DIRECTORY/network.temp)
	case $network_test in
	    Update )
		ans=n
		;;
	    Modify )
		ans=n
		setup_nicfile
		;;
	    Upgrade )
		ans=n
		install_networking
		;;
	    * )
		ans=y
		dialog --backtitle "$sgl_logo"  --msgbox "You must select one of the options." 0 0
		;;
	
	esac
	
    done
else
    install_networking
fi
