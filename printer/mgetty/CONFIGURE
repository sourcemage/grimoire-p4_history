if  !  grep  -q  'CONFIGURED=\"y\"'  ${DEPENDS_CONFIG}/mgetty;  then
  ############################################################
  ##  Select the optional programs to install.
  if  query  "Include vgetty to add voice mail capabilities? " y;  then
    echo  'INCLUDE_VGETTY="y"'  >>  ${SPELL_CONFIG}
  else
    echo  'INCLUDE_VGETTY="n"'  >>  ${SPELL_CONFIG}
  fi



  ############################################################
  ##  Select the options to enable.
  if  query  "Apply login prompt and login timeout patch? "  n;  then
    LOGIN_PATCH="y"
  else
    LOGIN_PATCH="n"
  fi
  echo  "LOGIN_PATCH=${LOGIN_PATCH}"  >>  ${SPELL_CONFIG}

  if  query  "Apply patch to execute the new_fax script for every new faxed received? "  y;  then
    echo  'NEWFAX_PATCH="y"'  >>  ${SPELL_CONFIG}
    NEWFAX_PATCH="y"
  else
    echo  'NEWFAX_PATCH="n"'  >>  ${SPELL_CONFIG}
  fi



  ############################################################
  ##  Set the number of rings to answer on.
  message  "${MESSAGE_COLOR}Type in the number of rings to answer on (the default is 2):${DEFAULT_COLOR}"
  read  -t  ${PROMPT_DELAY}  -e
  NUM_RINGS=${REPLY:=2}
  echo  "NUM_RINGS=${NUM_RINGS}"  >>  ${SPELL_CONFIG}



  ############################################################
  ##  Set the TTY device to be used for mgetty.
  while [ "${TTY_DEVICE}" == "" ]; do
    message  "${MESSAGE_COLOR}The following questions will setup the device to use ${SPELL_COLOR}mgetty${MESSAGE_COLOR} on:${DEFAULT_COLOR}"
    for  TTY_DEVICE  in  `ls  ${INSTALL_ROOT}/dev/ttyS*`;  do
      if  query  "Use ${TTY_DEVICE} for the mgetty device? " n;  then
        echo  "TTY_DEVICE=${TTY_DEVICE}"  >>  ${SPELL_CONFIG}
        break
      else
        unset TTY_DEVICE
      fi
    done
  done


  ############################################################
  # Setup final init string
  if [ -e ${SCRIPT_DIRECTORY}/mgetty-fax-backup ]; then
    cp -f ${SCRIPT_DIRECTORY}/mgetty-fax-backup ${SCRIPT_DIRECTORY}/init.d/mgetty-fax
  else
    cp -f ${SCRIPT_DIRECTORY}/init.d/mgetty-fax ${SCRIPT_DIRECTORY}/mgetty-fax-backup
  fi

  DAEMON_START="daemon --name=mgetty${TTY_DEVICE:5} --pidfile=${INSTALL_ROOT}/var/run/mgetty.pid.${TTY_DEVICE:5} --respawn ${INSTALL_ROOT}/usr/sbin/mgetty -n ${NUM_RINGS} ${TTY_DEVICE}"
  echo  "DAEMON_START='${DAEMON_START}'"
  echo  "DAEMON_START=\"${DAEMON_START}\""  >>  ${SPELL_CONFIG}
  sedit "s:DAEMON_START:${DAEMON_START}:" ${SCRIPT_DIRECTORY}/init.d/mgetty-fax

  DAEMON_STOP="daemon --name=mgetty${TTY_DEVICE:5} --pidfile=${INSTALL_ROOT}/var/run/mgetty.pid.${TTY_DEVICE:5} --stop"
  echo  "DAEMON_STOP='${DAEMON_STOP}'"
  echo  "DAEMON_STOP=\"${DAEMON_STOP}\""  >>  ${SPELL_CONFIG}
  sedit "s:DAEMON_STOP:${DAEMON_STOP}:" ${SCRIPT_DIRECTORY}/init.d/mgetty-fax

  DAEMON_RESTART="daemon --name=mgetty${TTY_DEVICE:5} --pidfile=${INSTALL_ROOT}/var/run/mgetty.pid.${TTY_DEVICE:5} --restart"
  echo  "DAEMON_RESTART='${DAEMON_RESTART}'"
  echo  "DAEMON_RESTART=\"${DAEMON_RESTART}\""  >>  ${SPELL_CONFIG}
  sedit "s:DAEMON_RESTART:${DAEMON_RESTART}:" ${SCRIPT_DIRECTORY}/init.d/mgetty-fax

  DAEMON_STATUS="daemon --name=mgetty${TTY_DEVICE:5} --pidfile=${INSTALL_ROOT}/var/run/mgetty.pid.${TTY_DEVICE:5} --running"
  echo  "DAEMON_STATUS='${DAEMON_STATUS}'"
  echo  "DAEMON_STATUS=\"${DAEMON_STATUS}\""  >>  ${SPELL_CONFIG}
  sedit "s:DAEMON_STATUS:${DAEMON_STATUS}:" ${SCRIPT_DIRECTORY}/init.d/mgetty-fax



  echo  'CONFIGURED="y"'  >>  ${SPELL_CONFIG}
fi
