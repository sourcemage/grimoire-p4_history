===================================================================
RCS file: /home/cvspublic/apr-iconv/util/iconv_stream.h,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -r1.3 -r1.4
--- apr-iconv/util/iconv_stream.h	2001/06/28 05:54:24	1.3
+++ apr-iconv/util/iconv_stream.h	2003/05/28 14:08:13	1.4
@@ -7,7 +7,7 @@
 typedef apr_ssize_t (*iconv_stream_func)(void *d, void *buf, apr_size_t nbytes);
 
 typedef struct {
-	iconv_t		cd;
+	apr_iconv_t	cd;
 	apr_size_t	chars;
 	apr_size_t	in_bytes;
 	apr_size_t	out_bytes;
@@ -17,11 +17,11 @@
 	iconv_stream_func method;
 } iconv_stream;
 
-iconv_stream *iconv_stream_open(iconv_t cd, void *handle,
+iconv_stream *iconv_stream_open(apr_iconv_t cd, void *handle,
                                 iconv_stream_func method);
 void iconv_stream_close(iconv_stream *stream);
 
-iconv_stream *iconv_ostream_fopen(iconv_t cd, FILE *handle);
+iconv_stream *iconv_ostream_fopen(apr_iconv_t cd, FILE *handle);
 
 apr_ssize_t iconv_write(void *stream, const void *buf, apr_size_t nbytes);
 apr_ssize_t iconv_bwrite(void *stream, const void *buf, apr_size_t nbytes);
===================================================================
RCS file: /home/cvspublic/apr-iconv/util/iconv_stream.c,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -r1.4 -r1.5
--- apr-iconv/util/iconv_stream.c	2001/06/28 05:54:23	1.4
+++ apr-iconv/util/iconv_stream.c	2003/05/28 14:07:16	1.5
@@ -39,7 +39,7 @@
 
 #define buf_size 4096
 
-iconv_stream *iconv_stream_open(iconv_t cd, void *handle,
+iconv_stream *iconv_stream_open(apr_iconv_t cd, void *handle,
                                 iconv_stream_func method)
 {
     iconv_stream *res = malloc(sizeof(iconv_stream));
@@ -114,7 +114,7 @@
             if (left > size)
                 left = size;
             memcpy(stream->buf_ptr, buf, left);
-            (const char *)buf += left;
+            buf = ((const char *)buf) + left;
             size -= left;
             stream->buf_ptr += left;
             res = iconv_write(handle, stream->buffer,
@@ -141,7 +141,7 @@
                 return -1;
             res = 0;
         }
-        (const char *)buf += res;
+        buf = ((const char *)buf) + res;
         size -= res;
     } while (size && res);
     if (!size)
@@ -164,7 +164,7 @@
     return (res && !ferror((FILE *)handle)) ? res : -1;
 }
 
-iconv_stream *iconv_ostream_fopen(iconv_t cd, FILE *handle)
+iconv_stream *iconv_ostream_fopen(apr_iconv_t cd, FILE *handle)
 {
     return iconv_stream_open(cd, handle, fwrite_wrapper);
 }
===================================================================
RCS file: /home/cvspublic/apr-iconv/util/iconv.c,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -r1.5 -r1.6
--- apr-iconv/util/iconv.c	2001/06/28 05:54:23	1.5
+++ apr-iconv/util/iconv.c	2003/05/28 14:05:50	1.6
@@ -81,7 +81,7 @@
 int
 main(int argc, char * const *argv)
 {
-	iconv_t cd;
+	apr_iconv_t cd;
 	iconv_stream *is;
 	char *from = NULL, *to = NULL, *input = NULL;
 	int opt;
@@ -98,6 +98,10 @@
 			break;
 		    case 's':
 			input = optarg;
+			break;
+		    default:
+			fprintf(stderr, "Usage: iconv -f <name> -t <name> [-s <input>]\n");
+			exit(3);
 		}
 	}
 	if (from == NULL) {
@@ -118,9 +122,9 @@
 	}
 
 	/* Use it */
-	status = apr_iconv_open(to, from,ctx, &cd);
+	status = apr_iconv_open(to, from, ctx, &cd);
 	if (status) {
-		fprintf(stderr, "unable to open specified convertor\n");
+		fprintf(stderr, "unable to open specified converter\n");
 		exit(6);
 		}
 	if (!(is = iconv_ostream_fopen(cd, stdout))) {
