default_pre_build  &&

#
# Set GLIBC_HEADERS_DIR for use later
#
persistent_add  GLIBC_HEADERS_DIR                                        &&
GLIBC_HEADERS_DIR=$SOURCE_DIRECTORY/linux-libc-headers-$HEADERS_VERSION  &&

if  [  "$GLIBC_NPTL"  =  "y"  ];  then
  cd      $SOURCE_DIRECTORY                           &&
  #
  # Unpack glibc-kernel-headers
  #
  unpack  $SOURCE2  ${MD5[1]}                         &&
  cd  $GLIBC_HEADERS_DIR                              &&
  patch  -p1  <  $SCRIPT_DIRECTORY/config.h.patch     &&
  #
  # Now fixup the normal glibc
  #
  cd  $SOURCE_DIRECTORY                               &&
  patch  -p0  <  $SCRIPT_DIRECTORY/glibcshared.patch  &&
  cd  $SOURCE_DIRECTORY/include                       &&
  chmod  -R  +r  *                                    &&
  find  .  -type  d  -exec  chmod  +x  '{}'  ';'
else
  cd      $SOURCE_DIRECTORY                         &&
  #
  # Now unpack the rest of glibc fixes in the normal location
  #
  unpack  $SOURCE2  ${MD5[1]}                       &&
  unpack  $SOURCE3  ${MD5[2]}                       &&
  #
  # Apply gcc 3.3 patch
  #
  bzcat  ${SOURCE_CACHE}/${SOURCE3}  |  patch  -p1  &&
  #
  # Unpack glibc-kernel-headers
  #
  mkdir  $GLIBC_HEADERS_DIR                         &&
  cd  $GLIBC_HEADERS_DIR                            &&
  unpack  $SOURCE4  ${MD5[3]}
fi  &&

#
# Create the build directory
#
mk_source_dir  $SOURCE_DIRECTORY.bld
