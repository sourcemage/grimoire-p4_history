if  [  !  -f  /root/.cvspass  ];  then
  touch /root/.cvspass
fi                                                                          &&

local  FIREFOX_TARBALL=firefox_cvs.tar.bz2                                  &&
mk_source_dir  $SOURCE_DIRECTORY                                            &&

if  [  "$FIREFOX_CVS"  =  "y"   ]                                           &&
    [  -f  $SOURCE_CACHE/$FIREFOX_TARBALL  ];  then
  message  "${MESSAGE_COLOR}Unpacking source file $FIREFOX_TARBALL"         \
           "$for ${SPELL_COLOR}$SPELL${DEFAULT_COLOR}"                      &&
  tar  jxf  $SOURCE_CACHE/$FIREFOX_TARBALL
else
  unpack  ${SOURCE}   ${MD5[0]}                             
fi                                                                          &&

#
#cvs updates anyone?
#
if  [  "$FIREFOX_CVS"  =  "y"  ];  then
  message  "${MESSAGE_COLOR}\tIt can take some considerable time to"        \
           "\tregenerate the cvs tags you will not see much progress or a"  \
           "\ttime but do not despair, GOOD THINGS are happening in the"    \
           "\tbackground.${DEFAULT_COLOR}"                                  &&
  cvs  -z9  -q  -d:pserver:anonymous@cvs-mirror.mozilla.org:/cvsroot        \
       checkout -PA  -d  mozilla mozilla/client.mk                          &&
  cd  $SOURCE_DIRECTORY                                                     &&
  if  [  "$FIREFOX_SVG"  =  "y"  ];  then
    make  -j1  -f  client.mk  checkout  MOZ_CO_FLAGS=-PA  MOZ_PHOENIX=1     \
          MOZ_INTERNAL_LIBART_LGPL=1
  else
    make  -j1  -f  client.mk  checkout  MOZ_CO_FLAGS=-PA  MOZ_PHOENIX=1 
  fi                                                                        &&
  cd  $BUILD_DIRECTORY                                                      &&
  message  "${MESSAGE_COLOR}Generating tarball for reuse"                   &&
  tar  jcf  $FIREFOX_TARBALL  mozilla/                                      &&
  message  "Moving $FIREFOX_TARBALL to/var/spool/sorcery${DEFAULT_COLOR}"   &&
  mv  -v  $FIREFOX_TARBALL  $SOURCE_CACHE/
fi                                                                          &&

cd  $SOURCE_DIRECTORY                                                       &&
# Patches for freetype 2.1.8 and gcc 3.4
patch  -p1  <  $SCRIPT_DIRECTORY/freetype.patch
#
# These don't apply against 1.0
#
#patch -p1 < $SCRIPT_DIRECTORY/firefox-pkgconfig.diff
# patch -p0<$SCRIPT_DIRECTORY/nsRegion.patch
#
