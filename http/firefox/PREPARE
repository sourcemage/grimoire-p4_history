VERSION=0.7.1
### move this to the beginning so the rest can stay untouched for each new update.
version_update() {
sedit '5,25D' $SPELL_CONFIG &&
echo -e  "VERSION=0.7.1
        SOURCE=MozillaFirebird-source-\${VERSION/.1/}.tar.gz
       SOURCE2=firebird-0.7-\${VERSION}.patch
 SOURCE_URL[0]=http://ftp.mozilla.org/pub/firebird/releases/\${VERSION/.1/}/\$SOURCE
 SOURCE_URL[1]=ftp://ftp.access.ch/mirror/mozilla/firebird/releases/\${VERSION/.1/}/\$SOURCE
 SOURCE_URL[2]=ftp://ftp.in2p3.fr/pub/mozilla/firebird/releases/\${VERSION/.1/}/\$SOURCE
 SOURCE_URL[3]=ftp://ftp.sai.msu.su/pub/unix/WWW/browsers/\$SOURCE
SOURCE2_URL[0]=http://ftp.mozilla.org/pub/firebird/releases/\$VERSION/\$SOURCE2
SOURCE2_URL[1]=ftp://ftp.access.ch/mirror/mozilla/firebird/releases/\$VERSION/\$SOURCE2
SOURCE2_URL[2]=ftp://ftp.in2p3.fr/pub/mozilla/firebird/releases/\$VERSION/\$SOURCE2
SOURCE2_URL[3]=ftp://ftp.sai.msu.su/pub/unix/WWW/browsers/\$SOURCE2
        MD5[0]=1cf245568f170f17021b205e205d4676
        MD5[1]=856e9d91ad80f9ee18ef9517086c15ab"  >>  ${SPELL_CONFIG}  
}

if  grep -q HEADCODE=yes $SPELL_CONFIG; then
sedit "s/^VERSION=.*$/VERSION=$VERSION/g" $SPELL_CONFIG 
fi &&
if ! grep -q CONFIGURED $SPELL_CONFIG; then

 if query "This spell will download the latest offical release of MozillaFirebird.\n
    \tIt is then possible to UPDATE the Firebird code
    \tvia  cvs and get ALL the nice changes since the last release.
    \tWould you like to update to cvs HEAD ?" n 
         then HEADCODE=yes
#choose SVG
             if ! grep -q SVG $SPELL_CONFIG ;
                  then if query "\nWould you like native SVG support (scalable vector graphics) " n
                          then SVG=yes 
                       fi 
             fi 
         else HEADCODE=no &&
              SVG=no
 fi 

#choose toolkit

 if ! grep -q GTK $SPELL_CONFIG ;
     then if query "\nWould you like to use GTK+2 toolkit with in-built anti-aliasing (DEFAULT)?\n
                    Nicer looking but slower than the original gtk+ " y
              then GTK=2 
              elif query "\nWould you like to use original GTK+ toolkit ?
                          \t http://wiki.sourcemage.org/index.php?page=FaqUsage#mozfonts\n
                               Is a brief HOWTO for font anti-aliasing with gtk+ toolkit" y
                 then  GTK=1
                 else  GTK=2
          fi 
 fi && 

echo -e "HEADCODE=$HEADCODE
SVG=$SVG
GTK=$GTK
CONFIGURED=yes" >> $SPELL_CONFIG 
fi &&
if ! grep -q VERSION=$VERSION $SPELL_CONFIG ;
then version_update
fi &&

# touch the SOURCE tarball if you update via cvs and already have a cvs tarball
# otherwise you have to download 40 MB of crap

if [ "$HEADCODE" = "yes" ] && [ -f $SOURCE_CACHE/Firebird_cvs.tar.bz2 ] ;
then touch $SOURCE_CACHE/$SOURCE
fi

