
cd ${LINUX_SOURCE_DIRECTORY}

# make the append
mkdir -p ${INSTALL_ROOT}/boot
case "$VERSION" in
	2.6*)
		echo "installing for a 2.x kernel"
#		if [[ ! ${OPTIONAL_BUILD_DIR} ]]
#		then
			ARCH="$kernel_arch" make modules_install
#		else
#			ARCH="$kernel_arch" make O="${OPTIONAL_BUILD_DIR}" modules_install
#		fi
		;;
	2.[024]*)
		echo "installing for a $VERSION kernel"
		ARCH="$kernel_arch" make modules_install
		;;
	*)
		echo "I again don't know what version: $VERSION is"
		return 1
		;;
esac

#if [[ $OPTIONAL_BUILD_DIR ]]
#then
#	root=$OPTIONAL_BUILD_DIR
#else
	root="."
#fi

case  ${kernel_arch}  in
	ppc)
		cp ${root}/vmlinux \
		${INSTALL_ROOT}/boot/vmlinux-$VERSION &&
		ln -sf ${INSTALL_ROOT}/boot/vmlinux-${VERSION} \
		${INSTALL_ROOT}/boot/vmlinux
		;;
	sparc*)
		gzip -c9 ${root}/vmlinux > \
		${INSTALL_ROOT}/boot/vmlinuz-$VERSION &&
		ln -sf ${INSTALL_ROOT}/boot/vmlinuz-${VERSION} \
		${INSTALL_ROOT}/boot/vmlinuz
		;;
	*)
		cp ${root}/arch/${kernel_arch}/boot/bzImage \
		${INSTALL_ROOT}/boot/vmlinubz-$VERSION &&
		ln -sf ${INSTALL_ROOT}/boot/vmlinubz-${VERSION} \
		${INSTALL_ROOT}/boot/vmlinubz
	;;
esac

cp ${root}/System.map ${INSTALL_ROOT}/boot/System.map-${VERSION}
ln -sf ${INSTALL_ROOT}/boot/System.map-${VERSION} \
	${INSTALL_ROOT}/boot/System.map
cp ${root}/.config ${INSTALL_ROOT}/boot/config-${VERSION}
ln -sf ${INSTALL_ROOT}/boot/config-${VERSION} \
	${INSTALL_ROOT}/boot/config

cd ${BUILD_DIRECTORY}
rm linux
ln -sfn `basename ${LINUX_SOURCE_DIRECTORY}` linux

if [[ "$ARCHIVE" == "on" ]]
then
#	message "${MESSAGE_COLOR}Copying everything from ${LINUX_SOURCE_DIRECTORY} to ${SOURCE_DIRECTORY} for archiving${DEFAULT_COLOR}"
	mk_source_dir ${SOURCE_DIRECTORY} 
# apparently /usr/src/isn't tracked so this doesn't quite work
#	cp -a ${LINUX_SOURCE_DIRECTORY}/* ${SOURCE_DIRECTORY}/
fi

