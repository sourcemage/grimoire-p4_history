# The goal is:
# - to have the build directory persist after the cast.
# - to have the build directory name be based on the full version of xen being
#   used, not just the major version used for some versions of the tarball, so
#   that upgrades are less likely to clobber the working version.

mk_source_dir  ${SOURCE_DIRECTORY}  &&
cd  ${SOURCE_DIRECTORY}  &&
unpack_file  ''  &&

if  [  -e  ${XEN_SOURCE_DIRECTORY}  ]  ;  then
  if  [  -e  ${XEN_SOURCE_DIRECTORY}.old  ]  ;  then
    message "${MESSAGE_COLOR}${XEN_SOURCE_DIRECTORY}.old exists, not replacing${DEFAULT_COLOR}"
  else
    message "${MESSAGE_COLOR}Creating ${XEN_SOURCE_DIRECTORY}.old${DEFAULT_COLOR}"  &&
    cp  -a  ${XEN_SOURCE_DIRECTORY}  ${XEN_SOURCE_DIRECTORY}.old
  fi  &&
  rm  -rf  ${XEN_SOURCE_DIRECTORY}
fi  &&

mv ${SOURCE_DIRECTORY}/${REAL_SPELL}-${TARBALL_VERSION} ${XEN_SOURCE_DIRECTORY}
