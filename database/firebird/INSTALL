local FF i FileName DB                          &&
# new install script from here on
  cd gen					&&
  ./install/makeInstallImage.sh			&&

  cd buildroot/${INSTALL_ROOT}/$PREFIX		&&
# preserve some existing files
  for FF in `ls security.fdb firebird.conf aliases.conf bin/*.sh`; do
    if [ -f $PREFIX/$FF ];then
      echo preserving file $FF
      rm $FF
    fi
  done						&&
  
  cd $OLDPWD/buildroot/${INSTALL_ROOT}	&&

  cp -rd * ${INSTALL_ROOT}/  			&&

# fix permissions
  cd $PREFIX					&&
# For security reasons initially force all root:root non-writable
  chown -R root:root $PREFIX			&&
  chmod -R uga-w $PREFIX			&&
  
  cd bin					&&

# Everyone may execute clients
  chmod 0555 *					&&

# Shell scripts changing security attributes are for root only
  chmod 0500 *.sh				&&

  cd ..						&&

# Security database
# Nobody besides firebird permitted to even read this file
  chown firebird:firebird security.fdb		&&
  chmod 0600 security.fdb			&&
# all database should be owned by firebird
  for DB in `ls examples/*.fdb`
    do 
      chmod ug+w $DB                            &&
      chown firebird:firebird $DB
    done                                        &&
# create lock files
  for i in isc_init1 isc_lock1 isc_event1 isc_guard1
    do
      FileName=$i.`hostname`
      touch $FileName
      chown firebird:firebird $FileName
      chmod u+w $FileName
    done					&&

# make a symlink for use by old programs
  cd lib					&&
  ln -sf libfbclient.so libgds.so		&&
  cd ..						&&

# log file
  mkdir -p /var/log/				&&
  touch  /var/log/firebird.log			&&
  chown firebird:firebird /var/log/firebird.log	&&
  chmod o=,ug=rw /var/log/firebird.log		&&
  ln -sf /var/log/firebird.log ./
