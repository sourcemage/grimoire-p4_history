#!/bin/sh

# This program will configure the makefile for various OSes.
#
# Config version 1.1
SYS=

# Heading

cat > Makefile <<EoF
# Makefile for HEYU, a program to control an X10 CM11A computer interface.
# This makefile is generated by the Configure program.
#
EoF

# paths:
cat >> Makefile <<EoF
BIN = /usr/local/bin
MAN = /usr/man/man1
MAN5 = /usr/man/man5
GROUP = sys
OWNER = bin

#       set DFLAGS equal to:
#          -DSYSV       if using SYSTEM V
#          -DVOID       if compiler doesn't understand 'void'

EoF

while [ $# -ge 1 ] ; do
    case "$1" in
	help|-h|-help)
	    echo "Usage: $0 [ system type ]"
	    echo " Valid system types are linux,sunos,freebsd,sco,aix,netbsd,sysv, generic,osf"
	    echo "A guess will be made if no arguements are given."
	    rm Makefile 
	    exit
	    ;;
	*)
	    SYS="$1"
	    ;;
    esac
    shift
done

cat <<EoF
This script will create a valid Makefile based on the results of the uname(1) 
output.  Please stand-by a moment.
EoF


if [ "$SYS" = "" ] ; then
    SYS=`uname -s | tr '[A-Z]' '[a-z]'`
fi

echo "#This makefile is built for $SYS" >> Makefile
case "$SYS" in
    linux)
        cat >> Makefile <<-EoF
	CC = gcc
	CFLAGS = -g -O \$(DFLAGS) -Wall
	DFLAGS = -DSYSV -DPOSIX -DHAS_ITIMER -DLINUX -DHASSELECT
	LIBS = -lm -lc
EoF
	;;
    sunos*|solaris)
    	type gcc > /dev/null
    	if [ $? = 0 ] ; then
    	    echo "CC = gcc" >> Makefile
	else
	    echo "CC = cc" >> Makefile
	fi
	cat >> Makefile <<-EoF
		DFLAGS = -DSYSV -DPOSIX -DSOLARIS -DLOCKDIR=\"/var/spool/locks\" -DHASSELECT
		CFLAGS = -g -O \$(DFLAGS) -Wall
		LIBS = -lm -lc
EoF
	;;
    freebsd)
	cat >> Makefile <<-EoF
		CC = gcc
		CFLAGS = -g -O \$(DFLAGS) -Wall
		LIBS = -lm -lc
		DFLAGS= -DHASSELECT -DNEEDGTIME -DFREEBSD
EoF
	;;
    sco*)
	cat >> Makefile <<-EoF
		CC = cc
		MAN = /usr/local/man/man.1
		MAN5 = /usr/local/man/man.5
		CFLAGS = -O \$(DFLAGS)
		LIBS = -lm -lc -lsocket
		DFLAGS= -DSYSV -DHASSELECT -DSCO
EoF
	;;
    generic)
    	cat >> Makefile <<-EoF
		CC = gcc
		CFLAGS = -g -O \$(DFLAGS) -Wall
		LIBS = -lm -lc
EoF
	;;
    aix|sysv)
	cat >> Makefile <<-EoF
		CC = gcc
		CFLAGS = -g -O \$(DFLAGS) -Wall
		LIBS = -lm -lc
		DFLAGS = -DSYSV -DPOSIX 
EoF
	;;
    netbsd)
	cat >> Makefile <<-EoF
		DFLAGS = -DPOSIX -DLOCKDIR=\"/var/spool/lock\"
		CC = gcc
		CFLAGS = -g -O \$(DFLAGS) -Wall
		LIBS = -lm -lc
EoF
	;;
    nextstep)
	cat >> Makefile <<-EoF
		CC = gcc
		DFLAGS =  -DPOSIX
		CFLAGS = -g \$(DFLAGS) -posix
		LDFLAGS = -posix
		LIBS = -lm -lposix

EoF
	;;
    osf)
	cat >> Makefile <<-EoF
		GROUP = uucp
		CC = gcc
		CFLAGS = -g \$(DFLAGS)
		LIBS = -lm -lc
		DFLAGS = -DSYSV -DHAS_ITIMER -DOSF1 -DLOCKDIR=\"/var/spool/locks\"
EoF
	;;
    *)
    	echo "Your system type was not understood.  Please try one of "
    	echo "the following".
    	$0 -help
    	exit
    	;;
esac

cat >> Makefile <<EoF
# # The rest of the makefile should need no changes

EoF

cat Makefile.in >> Makefile

echo ""
echo "The Makefile has been created for $SYS."
echo ""
